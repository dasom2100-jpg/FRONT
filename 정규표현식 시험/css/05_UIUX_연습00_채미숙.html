<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(function() {
            $('input.selInput').on('blur', function() {
                let idnm = this.getAttribute('id');
                let regx;
                
                switch(idnm) {
                    case 'uid':
                        // 아이디는 영어대소문자, 숫자, _까지(옵션)만 가능하도록, 6-20자 이내
                        regx = /[a-zA-Z0-9_]{6,20}$/;
                        break;
                    case 'upw':
                        // 비번은 영어대소문자(영어대문자 1자이상필수), 숫자, 특수문자(1자이상필수)까지 가능하도록, 6-20자 이내
                        regx = /[a-zA-Z0-9!@#$%^&*필수입력()_+\-=\[\]{};':"\\|,.<>\/?]{6,20}$/;
                        break;
                    case 'unm':
                        // 영어, 한글만 가능하도록 (2-50자 이내)
                        regx = /[a-zA-Z가-힣]{2,50}$/;
                        break;
                    case 'utel':
                        // 앞부분은 010으로 시작, 숫자로만 입력 가능하도록 설정(11자로 설정)
                        regx = /^010\d{8}$/;
                        break;
                    case 'umail':
                        // 영어대소문자, 숫자, 특수문자(._-@만 가능)하도록 반드시 @기호 1개만 필수
                        regx = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                        break;
                    case 'ubirth':
                        // 년월일까지의 날짜범주이내로만 입력가능하도록 설정
                        regx = /\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/;
                        break;
                    default:
                        console.log('예정');
                }

                if(regx.test(this.value)) {
                    if(idnm === 'upw') {
                        if(!(this.value.search(/[A-Z]+/) > -1 && this.value.search(/[!@#$%^&*필수입력()_+\-=\[\]{};':"\\|,.<>\/?]+/) > -1)) {
                            $(this).next().show();
                            $(this).addClass('error').removeClass('success');
                        } else {
                            $(this).next().hide();
                            $(this).addClass('success').removeClass('error');
                        }
                    } else if(idnm === 'umail') {
                        let atCount = (this.value.match(/@/g) || []).length;
                        if(atCount !== 1) {
                            $(this).next().show();
                            $(this).addClass('error').removeClass('success');
                        } else {
                            $(this).next().hide();
                            $(this).addClass('success').removeClass('error');
                        }
                    } else {
                        $(this).next().hide();
                        $(this).addClass('success').removeClass('error');
                    }
                } else {
                    $(this).next().show();
                    $(this).addClass('error').removeClass('success');
                }
            });

            $('input.selInput').on('focus', function() {
                if($(this).hasClass('error')) {
                    $(this).removeClass('error success');
                    $(this).next().hide();
                }
            });

            $('input#utel').on('input', function() {
                this.value = this.value.replace(/[^\d]/g, '');
                if(this.value.length > 11) {
                    this.value = this.value.substring(0, 11);
                }
            });

            $('form').on('submit', function(e) {
                e.preventDefault();
                
                let isValid = true;
                let firstErrorField = null;

                $('input.selInput[required]').each(function() {
                    let idnm = this.getAttribute('id');
                    let value = this.value.trim();
                    
                    if(!value) {
                        $(this).next().text('필수 입력 항목입니다.').show();
                        $(this).addClass('error');
                        isValid = false;
                        
                        if(!firstErrorField) {
                            firstErrorField = this;
                        }
                        return;
                    }

                    $(this).trigger('blur');
                    
                    if($(this).hasClass('error')) {
                        isValid = false;
                        if(!firstErrorField) {
                            firstErrorField = this;
                        }
                    }
                });

                if(isValid) {
                    let formData = {
                        uid: $('#uid').val(),
                        upw: $('#upw').val(),
                        unm: $('#unm').val(),
                        utel: $('#utel').val(),
                        umail: $('#umail').val(),
                        ubirth: $('#ubirth').val()
                    };
                    
                    console.log('회원가입 데이터:', formData);
                    alert('회원가입이 완료되었습니다!\n\n아이디: ' + formData.uid + '\n이름: ' + formData.unm);
                } else {
                    alert('입력 정보를 확인해주세요.');
                    if(firstErrorField) {
                        $(firstErrorField).focus();
                    }
                }
            });

            $('input.selInput').on('keydown', function(e) {
                if(e.key === 'Enter') {
                    e.preventDefault();
                    let $inputs = $('input.selInput');
                    let currentIndex = $inputs.index(this);
                    
                    if(currentIndex < $inputs.length - 1) {
                        $inputs.eq(currentIndex + 1).focus();
                    } else {
                        $('button[type="submit"]').click();
                    }
                }
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>회원가입</h1>
        
        <form>
            <div class="form-group">
                <label for="uid">아이디 <span class="required">*필수입력</span></label>
                <input type="text" class="selInput" id="uid" name="uid" 
                       placeholder="영문, 숫자, _ 조합 6~20자" required>
                <p class="errMsg">영문, 숫자, 언더스코어(_)만 사용 가능합니다. (6~20자)</p>
            </div>

            <div class="form-group">
                <label for="upw">비밀번호 <span class="required">*필수입력</span></label>
                <input type="password" class="selInput" id="upw" name="upw" 
                       placeholder="영문 대문자, 특수문자 각 1자 이상 포함" required>
                <p class="errMsg">영문 대문자와 특수문자를 각각 1자 이상 포함해야 합니다. (6~20자)</p>
            </div>

            <div class="form-group">
                <label for="unm">이름 <span class="required">*필수입력</span></label>
                <input type="text" class="selInput" id="unm" name="unm" 
                       placeholder="한글 또는 영문 2~50자" required>
                <p class="errMsg">한글 또는 영문만 입력 가능합니다. (2~50자)</p>
            </div>

            <div class="form-group">
                <label for="utel">연락처 <span class="required">*필수입력</span></label>
                <input type="tel" class="selInput" id="utel" name="utel" 
                       placeholder="01012345678 (숫자만 11자)" 
                       maxlength="11" required>
                <p class="errMsg">010으로 시작하는 11자리 숫자를 입력해주세요.</p>
            </div>

            <div class="form-group">
                <label for="umail">이메일 <span class="required">*필수입력</span></label>
                <input type="email" class="selInput" id="umail" name="umail" 
                       placeholder="example@domain.com" required>
                <p class="errMsg">올바른 이메일 형식으로 입력해주세요. (@는 1개만)</p>
            </div>

            <div class="form-group">
                <label for="ubirth">생년월일</label>
                <input type="date" class="selInput" id="ubirth" name="ubirth">
                <p class="errMsg">올바른 날짜를 선택해주세요.</p>
            </div>

            <button type="submit" class="btn-submit">회원가입</button>
        </form>
    </div>
</body>
</html>