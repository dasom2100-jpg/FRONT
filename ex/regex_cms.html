<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2>회원가입</h2>
            </div>
            <div class="panel-body">
                <form id="signupForm">
                    <!-- 아이디 -->
                    <div class="form-group">
                        <label for="uid">아이디</label>
                        <input type="text" class="form-control selInput" id="uid"
                               placeholder="영문으로 시작, 4~20자" name="uid">
                        <div class="info-text">영문으로 시작, 영문/숫자/특수문자 4~20자 (공백 불가)</div>
                        <div class="error-message" id="uidError"></div>
                        <!-- <div class="success-message" id="uidSuccess">✓ 사용 가능한 아이디입니다.</div> -->
                    </div>

                    <!-- 비밀번호 -->
                    <div class="form-group">
                        <label for="upw">비밀번호</label>
                        <input type="password" class="form-control selInput" id="upw"
                               placeholder="영문 대문자, 숫자, 특수문자 포함" name="upw">
                        <div class="info-text">영문으로 시작, 4~20자, 대문자/숫자/특수문자 필수 (공백 불가)</div>
                        <div class="error-message" id="upwError"></div>
                        <!-- <div class="success-message" id="upwSuccess">✓ 안전한 비밀번호입니다.</div> -->
                    </div>

                    <button type="submit" class="btn btn-submit">회원가입</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        $(function() {
            // ============================================
            // 정규식 패턴 반환 함수
            // ============================================
            function getRegexPattern(fieldId) {
                switch(fieldId) {
                    case 'uid':
                        return /^[a-zA-Z][\w\W]{3,19}$/;
                    case 'upw':
                        return /^[a-zA-Z][\w\W]{3,19}$/;
                    default:
                        return /.*/;
                }
            }

            // ============================================
            // 에러 메시지 반환 함수
            // ============================================
            function getErrorMessage(fieldId, errorType) {
                const messages = {
                    uid: {
                        pattern: '영문으로 시작하는 4~20자로 입력해주세요.',
                        space: '공백은 사용할 수 없습니다.'
                    },
                    upw: {
                        pattern: '영문으로 시작하는 4~20자로 입력해주세요.',
                        space: '공백은 사용할 수 없습니다.',
                        requirement: '영문 대문자, 숫자, 특수문자를 각각 1개 이상 포함해야 합니다.'
                    }
                };

                return messages[fieldId][errorType] || '올바른 형식으로 입력해주세요.';
            }

            // ============================================
            // 유효성 검사 함수
            // ============================================
            function validateField(fieldId, value) {
                const $input = $('#' + fieldId);
                const $error = $('#' + fieldId + 'Error');
                const $success = $('#' + fieldId + 'Success');
                const regex = getRegexPattern(fieldId);

                // 초기화
                $input.removeClass('valid invalid');
                $error.removeClass('show');
                $success.removeClass('show');

                // 빈 값 체크
                if (!value || value.trim() === '') {
                    $input.addClass('invalid');
                    $error.text('필수 입력 항목입니다.').addClass('show');
                    return false;
                }

                // 기본 정규식 검사
                if (!regex.test(value)) {
                    $input.addClass('invalid');
                    $error.text(getErrorMessage(fieldId, 'pattern')).addClass('show');
                    return false;
                }

                // 공백 검사 (아이디, 비밀번호)
                if ((fieldId === 'uid' || fieldId === 'upw') && /\s/.test(value)) {
                    $input.addClass('invalid');
                    $error.text(getErrorMessage(fieldId, 'space')).addClass('show');
                    return false;
                }

                // 비밀번호 추가 검사 (대문자, 숫자, 특수문자 필수)
                if (fieldId === 'upw') {
                    const hasUpperCase = /[A-Z]/.test(value);
                    const hasNumber = /[0-9]/.test(value);
                    const hasSpecial = /[\W_]/.test(value);

                    if (!hasUpperCase || !hasNumber || !hasSpecial) {
                        $input.addClass('invalid');
                        $error.text(getErrorMessage(fieldId, 'requirement')).addClass('show');
                        return false;
                    }
                }

                // 유효성 검사 통과
                $input.addClass('valid');
                $success.addClass('show');
                return true;
            }

            // ============================================
            // 메시지 초기화 함수
            // ============================================
            function clearMessages(fieldId) {
                $('#' + fieldId).removeClass('valid invalid');
                $('#' + fieldId + 'Error').removeClass('show');
                $('#' + fieldId + 'Success').removeClass('show');
            }

            // ============================================
            // 입력 필드 이벤트 리스너
            // ============================================
            $('.selInput').on({
                // blur: 포커스를 잃을 때 유효성 검사
                blur: function() {
                    const fieldId = $(this).attr('id');
                    const value = $(this).val();

                    if (value) {
                        validateField(fieldId, value);
                    }
                },

                // focus: 포커스를 받을 때 에러 메시지 초기화
                focus: function() {
                    const fieldId = $(this).attr('id');

                    if ($(this).hasClass('invalid')) {
                        clearMessages(fieldId);
                    }
                },

                // input: valid 상태일 때 실시간 검사
                input: function() {
                    const fieldId = $(this).attr('id');
                    const value = $(this).val();

                    if ($(this).hasClass('valid')) {
                        validateField(fieldId, value);
                    }
                }
            });

            // ============================================
            // 폼 제출 이벤트
            // ============================================
            $('#signupForm').on('submit', function(e) {
                e.preventDefault();

                const uidValue = $('#uid').val();
                const upwValue = $('#upw').val();

                const isUidValid = validateField('uid', uidValue);
                const isUpwValid = validateField('upw', upwValue);

                if (isUidValid && isUpwValid) {
                    const formData = {
                        uid: uidValue,
                        upw: upwValue
                    };

                    console.log('회원가입 데이터:', formData);
                    alert('회원가입이 완료되었습니다!\n\n아이디: ' + formData.uid);

                    // 폼 초기화 (선택사항)
                    /*
                    this.reset();
                    $('.selInput').removeClass('valid invalid');
                    $('.error-message, .success-message').removeClass('show');
                    */
                } else {
                    alert('입력 정보를 확인해주세요.');

                    // 첫 번째 에러 필드로 포커스
                    if (!isUidValid) {
                        $('#uid').focus();
                    } else if (!isUpwValid) {
                        $('#upw').focus();
                    }
                }
            });

            // ============================================
            // 엔터키로 다음 필드 이동
            // ============================================
            $('.selInput').on('keydown', function(e) {
                if (e.key === "Enter") {
                    e.preventDefault();

                    const $inputs = $('.selInput');
                    const currentIndex = $inputs.index(this);

                    if (currentIndex < $inputs.length - 1) {
                        $inputs.eq(currentIndex + 1).focus();
                    } else {
                        $('#signupForm').submit();
                    }
                }
            });
        });
    </script>
</body>
</html>

